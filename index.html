<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fichas Propuestas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .bg-primary {
            background-color: #9C2348;
        }
        .bg-primary-light {
            background-color: #b52e5a;
        }
        .bg-primary-dark {
            background-color: #7d1c3a;
        }
        .bg-secondary {
            background-color: #A6802D;
        }
        .bg-secondary-light {
            background-color: #bf9a41;
        }
        .bg-secondary-dark {
            background-color: #8a6b22;
        }
        .bg-accent {
            background-color: #1E5B4F;
        }
        .bg-accent-light {
            background-color: #267c6c;
        }
        .bg-accent-dark {
            background-color: #16463c;
        }
        .text-primary {
            color: #9C2348;
        }
        .text-secondary {
            color: #A6802D;
        }
        .text-accent {
            color: #1E5B4F;
        }
        .border-primary {
            border-color: #9C2348;
        }
        .border-secondary {
            border-color: #A6802D;
        }
        .border-accent {
            border-color: #1E5B4F;
        }
        .preview-container {
            height: 70vh;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            background-color: white;
        }
        .tab-active {
            border-bottom: 3px solid #9C2348;
            font-weight: 600;
            color: #9C2348;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .document-card:hover {
            transform: translateY(-5px);
            transition: transform 0.2s ease;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #9C2348;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        .status-badge.draft {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-badge.review {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .status-badge.final {
            background-color: #d1fae5;
            color: #065f46;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Firebase Config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBEOhoRa3dP28WeGs2jTlDrUa5H9mPWEGI",
            authDomain: "fichas-propuestas.firebaseapp.com",
            projectId: "fichas-propuestas",
            storageBucket: "fichas-propuestas.firebasestorage.app",
            messagingSenderId: "83231445757",
            appId: "1:83231445757:web:667bff5f33d06528ed6494",
            measurementId: "G-BPEV7F66FH"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Enable anonymous authentication
        auth.signInAnonymously()
            .then(() => {
                console.log("Anonymous authentication successful");
            })
            .catch((error) => {
                console.error("Anonymous authentication error:", error);
            });
    </script>

    <!-- Navigation -->
    <nav class="bg-primary text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i data-feather="file-text" class="w-6 h-6"></i>
                <span class="text-xl font-bold">WorkFolio TrackMaster</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="addDocumentBtn" class="bg-secondary hover:bg-secondary-light px-4 py-2 rounded-lg flex items-center space-x-2 transition">
                    <i data-feather="plus" class="w-4 h-4"></i>
                    <span>Nueva Ficha</span>
                </button>
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="Buscar fichas..." class="bg-primary-light text-white placeholder-white/70 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary w-64">
                    <i data-feather="search" class="absolute right-3 top-2.5 text-white/70 w-4 h-4"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Tabs -->
        <div class="flex space-x-8 border-b border-gray-200 mb-6">
            <button class="tab-btn pb-3 px-1 text-gray-600 hover:text-primary transition" data-tab="all">Todas las Fichas</button>
            <button class="tab-btn pb-3 px-1 text-gray-600 hover:text-primary transition" data-tab="recent">Recientes</button>
            <button class="tab-btn pb-3 px-1 text-gray-600 hover:text-primary transition" data-tab="workers">Por Trabajador</button>
            <button class="tab-btn pb-3 px-1 text-gray-600 hover:text-primary transition" data-tab="final">Fichas Finales</button>
            <button class="tab-btn pb-3 px-1 text-gray-600 hover:text-primary transition" data-tab="institutions">Por Institución</button>
        </div>

        <!-- Filter Controls -->
        <div id="filterControls" class="mb-6 hidden">
            <div class="flex flex-wrap gap-4">
                <div>
                    <label for="institutionFilter" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Institución</label>
                    <select id="institutionFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Todas las instituciones</option>
                        <option value="Institución A">Institución A</option>
                        <option value="Institución B">Institución B</option>
                        <option value="Institución C">Institución C</option>
                    </select>
                </div>
                <div>
                    <label for="statusFilter" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Estado</label>
                    <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Todos los estados</option>
                        <option value="draft">Borrador</option>
                        <option value="review">En Revisión</option>
                        <option value="final">Final</option>
                    </select>
                </div>
                <div>
                    <label for="dateFilter" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Fecha</label>
                    <select id="dateFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">Todas las fechas</option>
                        <option value="today">Hoy</option>
                        <option value="week">Esta semana</option>
                        <option value="month">Este mes</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Document List -->
        <div id="documentsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Documents will be loaded here -->
            <div class="text-center py-10 text-gray-500 col-span-3">
                <div class="loading-spinner mx-auto"></div>
                <p class="mt-2">Cargando fichas...</p>
            </div>
        </div>

        <!-- Statistics Section -->
        <div id="statisticsSection" class="mt-12 hidden">
            <h2 class="text-xl font-bold text-primary mb-4">Estadísticas</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white rounded-lg shadow p-4 text-center">
                    <p class="text-2xl font-bold text-primary" id="totalDocuments">0</p>
                    <p class="text-gray-600">Total de Fichas</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4 text-center">
                    <p class="text-2xl font-bold text-accent" id="finalDocuments">0</p>
                    <p class="text-gray-600">Fichas Finales</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4 text-center">
                    <p class="text-2xl font-bold text-secondary" id="reviewDocuments">0</p>
                    <p class="text-gray-600">En Revisión</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4 text-center">
                    <p class="text-2xl font-bold text-gray-600" id="draftDocuments">0</p>
                    <p class="text-gray-600">Borradores</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Document Modal -->
    <div id="addDocumentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b px-6 py-4 sticky top-0 bg-white z-10">
                <h3 class="text-lg font-semibold text-primary">Nueva Ficha de Trabajo</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="documentForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2" for="workerName">Nombre del Trabajador</label>
                        <select id="workerName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            <option value="">Selecciona un trabajador</option>
                            <option value="Juan Pérez">Juan Pérez</option>
                            <option value="María García">María García</option>
                            <option value="Carlos López">Carlos López</option>
                            <option value="Ana Martínez">Ana Martínez</option>
                            <option value="Pedro Rodríguez">Pedro Rodríguez</option>
                            <option value="Laura Sánchez">Laura Sánchez</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2" for="institution">Institución</label>
                        <select id="institution" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            <option value="">Selecciona una institución</option>
                            <option value="Institución A">Institución A</option>
                            <option value="Institución B">Institución B</option>
                            <option value="Institución C">Institución C</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2" for="documentTitle">Título de la Ficha</label>
                        <input type="text" id="documentTitle" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2" for="documentDescription">Descripción</label>
                        <textarea id="documentDescription" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2" for="documentStatus">Estado de la Ficha</label>
                        <select id="documentStatus" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            <option value="draft">Borrador</option>
                            <option value="review">En Revisión</option>
                            <option value="final">Final</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Archivo DOCX</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="documentFile" accept=".docx" class="hidden">
                            <div id="fileDropArea" class="cursor-pointer">
                                <i data-feather="upload" class="w-10 h-10 mx-auto text-gray-400"></i>
                                <p class="mt-2 text-gray-600">Arrastra tu archivo aquí o haz clic para seleccionar</p>
                                <p class="text-sm text-gray-500 mt-1">Solo se aceptan archivos .docx (máx. 10MB)</p>
                            </div>
                            <div id="fileNameDisplay" class="mt-3 hidden">
                                <span class="text-primary font-medium"></span>
                                <button type="button" id="clearFileBtn" class="ml-2 text-red-500 hover:text-red-700">
                                    <i data-feather="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition">Cancelar</button>
                        <button type="submit" class="bg-primary hover:bg-primary-light px-4 py-2 text-white rounded-lg transition flex items-center space-x-2">
                            <i data-feather="save" class="w-4 h-4"></i>
                            <span>Guardar Ficha</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Document Preview Modal -->
    <div id="documentPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl h-[80vh] flex flex-col">
            <div class="flex justify-between items-center border-b px-6 py-4">
                <div>
                    <h3 class="text-lg font-semibold text-primary" id="previewTitle">Vista Previa</h3>
                    <p class="text-sm text-gray-500" id="previewWorker">Trabajador</p>
                    <p class="text-sm text-gray-500" id="previewInstitution">Institución</p>
                </div>
                <div class="flex space-x-3">
                    <button id="editStatusBtn" class="text-accent hover:text-accent-dark" title="Cambiar estado">
                        <i data-feather="edit" class="w-5 h-5"></i>
                    </button>
                    <button id="downloadBtn" class="text-secondary hover:text-secondary-dark" title="Descargar">
                        <i data-feather="download" class="w-5 h-5"></i>
                    </button>
                    <button id="deletePreviewBtn" class="text-red-500 hover:text-red-700" title="Eliminar">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                    </button>
                    <button id="closePreviewBtn" class="text-gray-500 hover:text-gray-700" title="Cerrar">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-hidden">
                <div class="h-full p-6">
                    <div id="previewContainer" class="preview-container">
                        <div class="flex items-center justify-center h-full">
                            <div class="text-center">
                                <div class="loading-spinner mx-auto"></div>
                                <p class="mt-3 text-gray-600">Cargando vista previa del documento...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t px-6 py-3 bg-gray-50 flex justify-between items-center">
                <div>
                    <p class="text-sm text-gray-500" id="previewDate">Subido el: </p>
                    <p class="text-sm text-gray-500" id="previewStatus">Estado: </p>
                </div>
                <div class="flex space-x-2">
                    <button id="prevDocBtn" class="px-3 py-1 border rounded-lg text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-feather="chevron-left" class="w-4 h-4"></i>
                    </button>
                    <button id="nextDocBtn" class="px-3 py-1 border rounded-lg text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-feather="chevron-right" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Edit Modal -->
    <div id="statusEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center border-b px-6 py-4">
                <h3 class="text-lg font-semibold text-primary">Cambiar Estado de la Ficha</h3>
                <button id="closeStatusModalBtn" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2" for="newStatus">Nuevo Estado</label>
                    <select id="newStatus" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="draft">Borrador</option>
                        <option value="review">En Revisión</option>
                        <option value="final">Final</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelStatusChangeBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition">Cancelar</button>
                    <button id="saveStatusChangeBtn" class="bg-primary hover:bg-primary-light px-4 py-2 text-white rounded-lg transition">Guardar Cambio</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="bg-red-100 p-2 rounded-full mr-3">
                        <i data-feather="alert-triangle" class="w-6 h-6 text-red-500"></i>
                    </div>
                    <h3 class="text-lg font-semibold">Confirmar Eliminación</h3>
                </div>
                <p class="text-gray-700 mb-6">¿Estás seguro de que deseas eliminar esta ficha de trabajo? Esta acción no se puede deshacer.</p>
                <div class="flex justify-end space-x-3">
                    <button id="cancelDeleteBtn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition">Cancelar</button>
                    <button id="confirmDeleteBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 text-white rounded-lg transition">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-16 transition-transform duration-300 z-50 hidden">
        <div class="flex items-center">
            <i data-feather="check-circle" class="w-5 h-5 mr-2 text-green-400"></i>
            <span id="toastMessage">Operación completada con éxito</span>
        </div>
    </div>

    <script>
        // =============================================
        // MÓDULO PRINCIPAL DE LA APLICACIÓN
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            
            // Referencias de Firebase
            let documentsCollection = db.collection('workDocuments');
            let currentUserId = null;
            let currentDocuments = [];
            let currentPreviewIndex = 0;
            let currentFileToDelete = null;
            let currentFileToUpdate = null;

            // Obtener ID de usuario actual (anónimo)
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUserId = user.uid;
                    loadDocuments();
                    loadStatistics();
                } else {
                    console.log("No hay usuario autenticado");
                }
            });

            // =============================================
            // FUNCIONALIDAD DE PESTAÑAS
            // =============================================
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('tab-active'));
                    this.classList.add('tab-active');
                    const tabId = this.dataset.tab;
                    filterDocuments(tabId);
                    
                    // Mostrar/ocultar controles de filtro según la pestaña
                    const filterControls = document.getElementById('filterControls');
                    if (tabId === 'all' || tabId === 'recent' || tabId === 'institutions') {
                        filterControls.classList.remove('hidden');
                    } else {
                        filterControls.classList.add('hidden');
                    }
                    
                    // Mostrar/ocultar estadísticas
                    const statisticsSection = document.getElementById('statisticsSection');
                    if (tabId === 'all') {
                        statisticsSection.classList.remove('hidden');
                    } else {
                        statisticsSection.classList.add('hidden');
                    }
                });
            });

            // Establecer primera pestaña como activa por defecto
            if (tabs.length > 0) {
                tabs[0].classList.add('tab-active');
                document.getElementById('filterControls').classList.remove('hidden');
                document.getElementById('statisticsSection').classList.remove('hidden');
            }

            // =============================================
            // FUNCIONALIDAD DE BÚSQUEDA
            // =============================================
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = this.value.toLowerCase();
                    if (searchTerm.length >= 2 || searchTerm.length === 0) {
                        filterDocumentsBySearch(searchTerm);
                    }
                }, 300);
            });

            // =============================================
            // FUNCIONALIDAD DE FILTROS
            // =============================================
            const institutionFilter = document.getElementById('institutionFilter');
            const statusFilter = document.getElementById('statusFilter');
            const dateFilter = document.getElementById('dateFilter');
            
            [institutionFilter, statusFilter, dateFilter].forEach(filter => {
                filter.addEventListener('change', function() {
                    const activeTab = document.querySelector('.tab-active').dataset.tab;
                    filterDocuments(activeTab);
                });
            });

            // =============================================
            // MODAL DE AÑADIR DOCUMENTO
            // =============================================
            const addDocumentBtn = document.getElementById('addDocumentBtn');
            const addDocumentModal = document.getElementById('addDocumentModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const documentForm = document.getElementById('documentForm');
            const documentFileInput = document.getElementById('documentFile');
            const fileDropArea = document.getElementById('fileDropArea');
            const fileNameDisplay = document.getElementById('fileNameDisplay');
            const clearFileBtn = document.getElementById('clearFileBtn');
            let selectedFile = null;

            // Abrir modal de añadir documento
            addDocumentBtn.addEventListener('click', () => {
                addDocumentModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });

            // Cerrar modal
            const closeModal = () => {
                addDocumentModal.classList.add('hidden');
                document.body.style.overflow = '';
                documentForm.reset();
                fileNameDisplay.classList.add('hidden');
                selectedFile = null;
            };

            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);

            // Manejo de subida de archivos
            fileDropArea.addEventListener('click', () => {
                documentFileInput.click();
            });

            documentFileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelection(e.target.files[0]);
                }
            });

            // Funcionalidad de arrastrar y soltar
            fileDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropArea.classList.add('border-primary', 'bg-primary-light/10');
            });

            fileDropArea.addEventListener('dragleave', () => {
                fileDropArea.classList.remove('border-primary', 'bg-primary-light/10');
            });

            fileDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropArea.classList.remove('border-primary', 'bg-primary-light/10');
                if (e.dataTransfer.files.length > 0) {
                    const file = e.dataTransfer.files[0];
                    if (file.name.endsWith('.docx')) {
                        handleFileSelection(file);
                    } else {
                        showToast('Por favor, sube solo archivos .docx', 'error');
                    }
                }
            });

            function handleFileSelection(file) {
                if (file.size > 10 * 1024 * 1024) {
                    showToast('El archivo es demasiado grande. El tamaño máximo permitido es 10MB.', 'error');
                    return;
                }
                selectedFile = file;
                fileNameDisplay.querySelector('span').textContent = file.name;
                fileNameDisplay.classList.remove('hidden');
            }

            clearFileBtn.addEventListener('click', () => {
                documentFileInput.value = '';
                fileNameDisplay.classList.add('hidden');
                selectedFile = null;
            });

            // Envío del formulario
            documentForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!selectedFile) {
                    showToast('Por favor, selecciona un archivo DOCX', 'error');
                    return;
                }

                const workerName = document.getElementById('workerName').value;
                const institution = document.getElementById('institution').value;
                const documentTitle = document.getElementById('documentTitle').value;
                const documentDescription = document.getElementById('documentDescription').value;
                const documentStatus = document.getElementById('documentStatus').value;

                try {
                    // Mostrar indicador de carga
                    const submitButton = documentForm.querySelector('button[type="submit"]');
                    const originalText = submitButton.innerHTML;
                    submitButton.innerHTML = '<div class="loading-spinner mx-auto"></div>';
                    submitButton.disabled = true;

                    // Leer archivo como base64
                    const reader = new FileReader();
                    reader.readAsDataURL(selectedFile);
                    
                    reader.onload = async () => {
                        const base64String = reader.result.split(',')[1];
                        
                        // Añadir documento a Firestore
                        await documentsCollection.add({
                            workerName: workerName,
                            institution: institution,
                            title: documentTitle,
                            description: documentDescription,
                            status: documentStatus,
                            fileName: selectedFile.name,
                            fileData: base64String,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            userId: currentUserId
                        });

                        // Restaurar botón
                        submitButton.innerHTML = originalText;
                        submitButton.disabled = false;

                        closeModal();
                        loadDocuments();
                        loadStatistics();
                        showToast('Ficha guardada correctamente', 'success');
                    };
                    
                    reader.onerror = () => {
                        submitButton.innerHTML = originalText;
                        submitButton.disabled = false;
                        showToast('Error al leer el archivo. Inténtalo de nuevo.', 'error');
                    };
                } catch (error) {
                    console.error('Error añadiendo documento:', error);
                    showToast('Error al guardar la ficha. Inténtalo de nuevo.', 'error');
                }
            });

            // =============================================
            // MODAL DE VISTA PREVIA
            // =============================================
            const previewModal = document.getElementById('documentPreviewModal');
            const closePreviewBtn = document.getElementById('closePreviewBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const deletePreviewBtn = document.getElementById('deletePreviewBtn');
            const editStatusBtn = document.getElementById('editStatusBtn');
            const confirmModal = document.getElementById('confirmModal');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const prevDocBtn = document.getElementById('prevDocBtn');
            const nextDocBtn = document.getElementById('nextDocBtn');

            closePreviewBtn.addEventListener('click', () => {
                previewModal.classList.add('hidden');
                document.body.style.overflow = '';
            });

            // Abrir vista previa del documento
            function openDocumentPreview(index) {
                currentPreviewIndex = index;
                const doc = currentDocuments[index];
                
                document.getElementById('previewTitle').textContent = doc.title;
                document.getElementById('previewWorker').textContent = `Trabajador: ${doc.workerName}`;
                document.getElementById('previewInstitution').textContent = `Institución: ${doc.institution}`;
                document.getElementById('previewDate').textContent = `Subido el: ${new Date(doc.createdAt?.seconds * 1000).toLocaleDateString()}`;
                document.getElementById('previewStatus').textContent = `Estado: ${getStatusText(doc.status)}`;
                
                const previewContainer = document.getElementById('previewContainer');
                previewContainer.innerHTML = `
                    <div class="flex items-center justify-center h-full">
                        <div class="text-center">
                            <div class="loading-spinner mx-auto"></div>
                            <p class="mt-3 text-gray-600">Preparando vista previa...</p>
                        </div>
                    </div>
                `;
                
                previewModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Actualizar botones de navegación
                prevDocBtn.disabled = index <= 0;
                nextDocBtn.disabled = index >= currentDocuments.length - 1;

                // Convertir y mostrar el contenido DOCX
                renderDocxContent(doc.fileData, previewContainer);
            }

            // Función para convertir DOCX a HTML usando Mammoth
            function renderDocxContent(base64Data, container) {
                try {
                    // Decodificar base64 a ArrayBuffer
                    const binaryString = atob(base64Data);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    const arrayBuffer = bytes.buffer;

                    // Convertir DOCX a HTML
                    mammoth.convertToHtml({arrayBuffer: arrayBuffer})
                        .then(function(result) {
                            container.innerHTML = result.value;
                            
                            // Añadir estilos para mejorar la presentación
                            const style = document.createElement('style');
                            style.textContent = `
                                .preview-container h1, .preview-container h2, .preview-container h3 {
                                    color: #9C2348;
                                    margin-top: 1.5rem;
                                    margin-bottom: 0.5rem;
                                }
                                .preview-container p {
                                    margin-bottom: 1rem;
                                    line-height: 1.6;
                                }
                                .preview-container table {
                                    border-collapse: collapse;
                                    width: 100%;
                                    margin-bottom: 1rem;
                                }
                                .preview-container table, .preview-container th, .preview-container td {
                                    border: 1px solid #ddd;
                                }
                                .preview-container th, .preview-container td {
                                    padding: 8px;
                                    text-align: left;
                                }
                                .preview-container th {
                                    background-color: #f2f2f2;
                                }
                            `;
                            container.appendChild(style);
                        })
                        .catch(function(error) {
                            console.error('Error converting DOCX:', error);
                            container.innerHTML = `
                                <div class="p-6">
                                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                                        <div class="flex">
                                            <div class="flex-shrink-0">
                                                <i data-feather="alert-circle" class="h-5 w-5 text-yellow-400"></i>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm text-yellow-700">
                                                    No se pudo cargar la vista previa del documento. Puedes descargarlo para verlo.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <h2 class="text-xl font-bold text-primary mb-2">${doc.title}</h2>
                                    <div class="flex items-center mb-4">
                                        <i data-feather="user" class="w-4 h-4 mr-2 text-secondary"></i>
                                        <span class="text-sm text-gray-700">${doc.workerName}</span>
                                    </div>
                                    <div class="mb-4">
                                        <h3 class="text-lg font-semibold mb-2">Descripción</h3>
                                        <p class="text-gray-700">${doc.description || 'No hay descripción disponible.'}</p>
                                    </div>
                                    <div class="mb-4">
                                        <h3 class="text-lg font-semibold mb-2">Información del Archivo</h3>
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i data-feather="file" class="w-4 h-4 mr-2 text-accent"></i>
                                                <span class="text-sm">${doc.fileName}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <i data-feather="calendar" class="w-4 h-4 mr-2 text-accent"></i>
                                                <span class="text-sm">Subido el: ${new Date(doc.createdAt?.seconds * 1000).toLocaleString()}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            feather.replace();
                        });
                } catch (error) {
                    console.error('Error processing document:', error);
                    container.innerHTML = '<p class="text-red-500 p-4">Error al procesar el documento.</p>';
                }
            }

            // Navegación entre documentos
            prevDocBtn.addEventListener('click', () => {
                if (currentPreviewIndex > 0) {
                    openDocumentPreview(currentPreviewIndex - 1);
                }
            });

            nextDocBtn.addEventListener('click', () => {
                if (currentPreviewIndex < currentDocuments.length - 1) {
                    openDocumentPreview(currentPreviewIndex + 1);
                }
            });

            // Descargar documento
            downloadBtn.addEventListener('click', () => {
                const doc = currentDocuments[currentPreviewIndex];
                const link = document.createElement('a');
                link.href = `data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,${doc.fileData}`;
                link.download = doc.fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast('Documento descargado correctamente', 'success');
            });

            // Eliminar documento
            deletePreviewBtn.addEventListener('click', () => {
                currentFileToDelete = currentDocuments[currentPreviewIndex].id;
                confirmModal.classList.remove('hidden');
            });

            cancelDeleteBtn.addEventListener('click', () => {
                confirmModal.classList.add('hidden');
                currentFileToDelete = null;
            });

            confirmDeleteBtn.addEventListener('click', async () => {
                if (currentFileToDelete) {
                    try {
                        await documentsCollection.doc(currentFileToDelete).delete();
                        confirmModal.classList.add('hidden');
                        previewModal.classList.add('hidden');
                        document.body.style.overflow = '';
                        loadDocuments();
                        loadStatistics();
                        showToast('Ficha eliminada correctamente', 'success');
                    } catch (error) {
                        console.error('Error eliminando documento:', error);
                        showToast('Error al eliminar la ficha. Inténtalo de nuevo.', 'error');
                    }
                }
            });

            // =============================================
            // MODAL DE CAMBIO DE ESTADO
            // =============================================
            const statusEditModal = document.getElementById('statusEditModal');
            const closeStatusModalBtn = document.getElementById('closeStatusModalBtn');
            const cancelStatusChangeBtn = document.getElementById('cancelStatusChangeBtn');
            const saveStatusChangeBtn = document.getElementById('saveStatusChangeBtn');
            const newStatusSelect = document.getElementById('newStatus');

            editStatusBtn.addEventListener('click', () => {
                const currentDoc = currentDocuments[currentPreviewIndex];
                newStatusSelect.value = currentDoc.status;
                statusEditModal.classList.remove('hidden');
                currentFileToUpdate = currentDoc.id;
            });

            closeStatusModalBtn.addEventListener('click', () => {
                statusEditModal.classList.add('hidden');
                currentFileToUpdate = null;
            });

            cancelStatusChangeBtn.addEventListener('click', () => {
                statusEditModal.classList.add('hidden');
                currentFileToUpdate = null;
            });

            saveStatusChangeBtn.addEventListener('click', async () => {
                if (currentFileToUpdate) {
                    try {
                        await documentsCollection.doc(currentFileToUpdate).update({
                            status: newStatusSelect.value,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        statusEditModal.classList.add('hidden');
                        loadDocuments();
                        
                        // Actualizar la vista previa actual si está abierta
                        if (!previewModal.classList.contains('hidden')) {
                            const updatedDoc = await documentsCollection.doc(currentFileToUpdate).get();
                            currentDocuments[currentPreviewIndex] = {
                                id: updatedDoc.id,
                                ...updatedDoc.data()
                            };
                            openDocumentPreview(currentPreviewIndex);
                        }
                        
                        showToast('Estado actualizado correctamente', 'success');
                    } catch (error) {
                        console.error('Error actualizando estado:', error);
                        showToast('Error al actualizar el estado. Inténtalo de nuevo.', 'error');
                    }
                }
            });

            // =============================================
            // FUNCIONES PRINCIPALES
            // =============================================

            // Cargar documentos desde Firestore
            function loadDocuments() {
                if (!currentUserId) {
                    console.log("Esperando ID de usuario...");
                    return;
                }
            
                // Usar onSnapshot para escuchar cambios en tiempo real
                documentsCollection.where('userId', '==', currentUserId)
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((querySnapshot) => {
                        currentDocuments = [];
                        const documentsContainer = document.getElementById('documentsContainer');
                        
                        if (querySnapshot.empty) {
                            documentsContainer.innerHTML = `
                                <div class="col-span-1 md:col-span-2 lg:col-span-3 text-center py-16 text-gray-500 fade-in">
                                    <i data-feather="folder" class="w-16 h-16 mx-auto"></i>
                                    <p class="mt-4 text-lg">No hay fichas de trabajo disponibles</p>
                                    <p class="text-gray-500 mt-2">Comienza añadiendo tu primera ficha</p>
                                    <button id="addFirstDocumentBtn" class="mt-6 bg-primary hover:bg-primary-light px-6 py-3 text-white rounded-lg transition flex items-center space-x-2 mx-auto">
                                        <i data-feather="plus" class="w-5 h-5"></i>
                                        <span>Añadir primera ficha</span>
                                    </button>
                                </div>
                            `;
                            feather.replace();
                            
                            document.getElementById('addFirstDocumentBtn')?.addEventListener('click', () => {
                                addDocumentBtn.click();
                            });
                            return;
                        }
                        
                        querySnapshot.forEach((doc) => {
                            const documentData = doc.data();
                            documentData.id = doc.id;
                            currentDocuments.push(documentData);
                        });
                        
                        // Aplicar filtro según la pestaña activa
                        const activeTab = document.querySelector('.tab-active').dataset.tab;
                        filterDocuments(activeTab);
                    }, (error) => {
                        console.error('Error obteniendo documentos:', error);
                        showToast('Error al cargar las fichas. Inténtalo de nuevo.', 'error');
                    });
            }

            // Filtrar documentos
            function filterDocuments(filterType) {
                let filteredDocuments = [...currentDocuments];
                
                // Aplicar filtros según el tipo de pestaña
                switch (filterType) {
                    case 'recent':
                        // Mostrar documentos de los últimos 7 días
                        const oneWeekAgo = new Date();
                        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                        filteredDocuments = filteredDocuments.filter(doc => {
                            const docDate = new Date(doc.createdAt?.seconds * 1000);
                            return docDate >= oneWeekAgo;
                        });
                        break;
                    case 'workers':
                        // Agrupar por trabajador (se hará en renderDocuments)
                        break;
                    case 'final':
                        // Mostrar solo fichas finales
                        filteredDocuments = filteredDocuments.filter(doc => doc.status === 'final');
                        break;
                    case 'institutions':
                        // Agrupar por institución (se hará en renderDocuments)
                        break;
                    default:
                        // 'all' - mostrar todos los documentos
                        break;
                }
                
                // Aplicar filtros adicionales
                const institutionFilterValue = institutionFilter.value;
                const statusFilterValue = statusFilter.value;
                const dateFilterValue = dateFilter.value;
                
                if (institutionFilterValue) {
                    filteredDocuments = filteredDocuments.filter(doc => doc.institution === institutionFilterValue);
                }
                
                if (statusFilterValue) {
                    filteredDocuments = filteredDocuments.filter(doc => doc.status === statusFilterValue);
                }
                
                if (dateFilterValue) {
                    const now = new Date();
                    let startDate;
                    
                    switch (dateFilterValue) {
                        case 'today':
                            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                            break;
                        case 'week':
                            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);
                            break;
                        case 'month':
                            startDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                            break;
                    }
                    
                    if (startDate) {
                        filteredDocuments = filteredDocuments.filter(doc => {
                            const docDate = new Date(doc.createdAt?.seconds * 1000);
                            return docDate >= startDate;
                        });
                    }
                }
                
                renderDocuments(filteredDocuments, filterType);
            }

            // Filtrar documentos por búsqueda
            function filterDocumentsBySearch(searchTerm) {
                if (!searchTerm) {
                    const activeTab = document.querySelector('.tab-active').dataset.tab;
                    filterDocuments(activeTab);
                    return;
                }
                
                const filteredDocuments = currentDocuments.filter(doc => {
                    return (
                        doc.title.toLowerCase().includes(searchTerm) ||
                        doc.workerName.toLowerCase().includes(searchTerm) ||
                        doc.institution.toLowerCase().includes(searchTerm) ||
                        (doc.description && doc.description.toLowerCase().includes(searchTerm))
                    );
                });
                
                renderDocuments(filteredDocuments, document.querySelector('.tab-active').dataset.tab);
            }

            // Renderizar documentos en el contenedor
            function renderDocuments(documentsToRender, filterType) {
                const documentsContainer = document.getElementById('documentsContainer');
                
                if (documentsToRender.length === 0) {
                    documentsContainer.innerHTML = `
                        <div class="col-span-1 md:col-span-2 lg:col-span-3 text-center py-16 text-gray-500 fade-in">
                            <i data-feather="search" class="w-16 h-16 mx-auto"></i>
                            <p class="mt-4 text-lg">No se encontraron fichas</p>
                            <p class="text-gray-500 mt-2">Intenta ajustar los filtros o términos de búsqueda</p>
                        </div>
                    `;
                    feather.replace();
                    return;
                }
                
                documentsContainer.innerHTML = '';
                
                // Agrupar documentos si es necesario
                if (filterType === 'workers') {
                    const groupedByWorker = groupDocumentsBy(documentsToRender, 'workerName');
                    renderGroupedDocuments(groupedByWorker, 'Trabajador', documentsContainer);
                } else if (filterType === 'institutions') {
                    const groupedByInstitution = groupDocumentsBy(documentsToRender, 'institution');
                    renderGroupedDocuments(groupedByInstitution, 'Institución', documentsContainer);
                } else {
                    // Renderizar documentos normalmente
                    documentsToRender.forEach((documentData, index) => {
                        const documentCard = createDocumentCard(documentData, index);
                        documentsContainer.appendChild(documentCard);
                    });
                }
                
                feather.replace();
                addDocumentEventListeners();
            }

            // Agrupar documentos por propiedad
            function groupDocumentsBy(documents, property) {
                return documents.reduce((groups, document) => {
                    const key = document[property];
                    if (!groups[key]) {
                        groups[key] = [];
                    }
                    groups[key].push(document);
                    return groups;
                }, {});
            }

            // Renderizar documentos agrupados
            function renderGroupedDocuments(groupedDocuments, groupType, container) {
                Object.keys(groupedDocuments).forEach(groupName => {
                    const groupSection = document.createElement('div');
                    groupSection.className = 'col-span-1 md:col-span-2 lg:col-span-3 mb-8 fade-in';
                    groupSection.innerHTML = `
                        <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">${groupType}: ${groupName}</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${groupedDocuments[groupName].map((doc, index) => createDocumentCardHTML(doc, index)).join('')}
                        </div>
                    `;
                    container.appendChild(groupSection);
                });
            }

            // Crear tarjeta de documento
            function createDocumentCard(documentData, index) {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition cursor-pointer document-card fade-in';
                card.innerHTML = createDocumentCardHTML(documentData, index);
                return card;
            }

            // Crear HTML de tarjeta de documento
            function createDocumentCardHTML(documentData, index) {
                const statusText = getStatusText(documentData.status);
                const statusClass = getStatusClass(documentData.status);
                
                return `
                    <div class="p-5 border-b">
                        <div class="flex justify-between items-start">
                            <h3 class="font-semibold text-lg text-primary truncate flex-1 mr-2">${documentData.title}</h3>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <p class="text-gray-600 text-sm mt-1 truncate">${documentData.description || 'Sin descripción'}</p>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center mb-3">
                            <div class="bg-accent-light text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0">
                                ${documentData.workerName.charAt(0).toUpperCase()}
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="text-sm font-medium truncate">${documentData.workerName}</p>
                                <p class="text-xs text-gray-500 truncate">${documentData.institution}</p>
                                <p class="text-xs text-gray-500">${new Date(documentData.createdAt?.seconds * 1000).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center border-t pt-3">
                            <button class="text-primary hover:text-primary-dark text-sm font-medium view-doc-btn" data-id="${documentData.id}">
                                <i data-feather="eye" class="w-4 h-4 mr-1"></i> Ver
                            </button>
                            <div class="flex space-x-2">
                                <button class="text-gray-500 hover:text-gray-700 download-doc-btn" data-id="${documentData.id}" title="Descargar">
                                    <i data-feather="download" class="w-4 h-4"></i>
                                </button>
                                <button class="text-accent hover:text-accent-dark edit-status-doc-btn" data-id="${documentData.id}" title="Cambiar estado">
                                    <i data-feather="edit" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Añadir event listeners a los documentos
            function addDocumentEventListeners() {
                // Event listeners para botones de vista
                document.querySelectorAll('.view-doc-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const docId = btn.dataset.id;
                        const index = currentDocuments.findIndex(doc => doc.id === docId);
                        if (index !== -1) {
                            openDocumentPreview(index);
                        }
                    });
                });
                
                // Event listeners para botones de descarga
                document.querySelectorAll('.download-doc-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const docId = btn.dataset.id;
                        const doc = currentDocuments.find(d => d.id === docId);
                        if (doc) {
                            const link = document.createElement('a');
                            link.href = `data:application/vnd.openxmlformats-officedocument.wordprocessingml.document;base64,${doc.fileData}`;
                            link.download = doc.fileName;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            showToast('Documento descargado correctamente', 'success');
                        }
                    });
                });
                
                // Event listeners para botones de cambiar estado
                document.querySelectorAll('.edit-status-doc-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        const docId = btn.dataset.id;
                        const doc = currentDocuments.find(d => d.id === docId);
                        if (doc) {
                            newStatusSelect.value = doc.status;
                            statusEditModal.classList.remove('hidden');
                            currentFileToUpdate = docId;
                        }
                    });
                });
                
                // Event listeners para las tarjetas completas
                document.querySelectorAll('div[id="documentsContainer"] > div, .document-card').forEach((card, index) => {
                    card.addEventListener('click', () => {
                        // Encontrar el índice correcto en currentDocuments
                        const docId = card.querySelector('.view-doc-btn')?.dataset.id;
                        if (docId) {
                            const docIndex = currentDocuments.findIndex(doc => doc.id === docId);
                            if (docIndex !== -1) {
                                openDocumentPreview(docIndex);
                            }
                        }
                    });
                });
            }

            // Cargar estadísticas
            function loadStatistics() {
                if (!currentUserId) return;
                
                documentsCollection.where('userId', '==', currentUserId)
                    .get()
                    .then((querySnapshot) => {
                        let total = 0;
                        let final = 0;
                        let review = 0;
                        let draft = 0;
                        
                        querySnapshot.forEach((doc) => {
                            total++;
                            const data = doc.data();
                            if (data.status === 'final') final++;
                            else if (data.status === 'review') review++;
                            else if (data.status === 'draft') draft++;
                        });
                        
                        document.getElementById('totalDocuments').textContent = total;
                        document.getElementById('finalDocuments').textContent = final;
                        document.getElementById('reviewDocuments').textContent = review;
                        document.getElementById('draftDocuments').textContent = draft;
                    })
                    .catch((error) => {
                        console.error('Error cargando estadísticas:', error);
                    });
            }

            // =============================================
            // FUNCIONES UTILITARIAS
            // =============================================

            // Obtener texto del estado
            function getStatusText(status) {
                switch (status) {
                    case 'draft': return 'Borrador';
                    case 'review': return 'En Revisión';
                    case 'final': return 'Final';
                    default: return 'Desconocido';
                }
            }

            // Obtener clase CSS del estado
            function getStatusClass(status) {
                switch (status) {
                    case 'draft': return 'draft';
                    case 'review': return 'review';
                    case 'final': return 'final';
                    default: return '';
                }
            }

            // Mostrar notificación toast
            function showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toastMessage');
                
                toastMessage.textContent = message;
                
                // Cambiar icono según el tipo
                const icon = toast.querySelector('i');
                if (type === 'error') {
                    icon.setAttribute('data-feather', 'alert-circle');
                    icon.classList.remove('text-green-400');
                    icon.classList.add('text-red-400');
                } else {
                    icon.setAttribute('data-feather', 'check-circle');
                    icon.classList.remove('text-red-400');
                    icon.classList.add('text-green-400');
                }
                feather.replace();
                
                toast.classList.remove('hidden');
                toast.classList.remove('translate-y-16');
                toast.classList.add('translate-y-0');
                
                setTimeout(() => {
                    toast.classList.remove('translate-y-0');
                    toast.classList.add('translate-y-16');
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 300);
                }, 3000);
            }
        });
    </script>
</body>
</html>
